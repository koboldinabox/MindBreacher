<!DOCTYPE html>
<script>
//  Qui dentro sono salvati tutti i 125 cubi vuoti esistenti e le loro proprietÃ 
// [x,y,z, type, group]
// type -> [0 = "not existing", 1 = "external", 2 = "internal", 3 = "goal"]
// group -> [0 = "none", 1 = "outer rim", 2 = "inner rim", 3 = "center"]

var memosGrid = [[1,1,1,0,1],[1,1,2,0,1],[1,1,3,0,1],[1,1,4,0,1],[1,1,5,0,1],
				 [1,2,1,0,1],[1,2,2,0,1],[1,2,3,0,1],[1,2,4,0,1],[1,2,5,0,1],
				 [1,3,1,0,1],[1,3,2,0,1],[1,3,3,0,1],[1,3,4,0,1],[1,3,5,0,1],
				 [1,4,1,0,1],[1,4,2,0,1],[1,4,3,0,1],[1,4,4,0,1],[1,4,5,0,1],
				 [1,5,1,0,1],[1,5,2,0,1],[1,5,3,0,1],[1,5,4,0,1],[1,5,5,0,1],
				                                                         
				 [2,1,1,0,1],[2,1,2,0,1],[2,1,3,0,1],[2,1,4,0,1],[2,1,5,0,1],
				 [2,2,1,0,1],[2,2,2,0,0],[2,2,3,0,0],[2,2,4,0,0],[2,2,5,0,1],
				 [2,3,1,0,1],[2,3,2,0,0],[2,3,3,0,2],[2,3,4,0,0],[2,3,5,0,1],
				 [2,4,1,0,1],[2,4,2,0,0],[2,4,3,0,0],[2,4,4,0,0],[2,4,5,0,1],
				 [2,5,1,0,1],[2,5,2,0,1],[2,5,3,0,1],[2,5,4,0,1],[2,5,5,0,1],
				                                                         
				 [3,1,1,0,1],[3,1,2,0,1],[3,1,3,0,1],[3,1,4,0,1],[3,1,5,0,1],
				 [3,2,1,0,1],[3,2,2,0,0],[3,2,3,0,2],[3,2,4,0,0],[3,2,5,0,1],
				 [3,3,1,0,1],[3,3,2,0,2],[3,3,3,0,3],[3,3,4,0,2],[3,3,5,0,1],
				 [3,4,1,0,1],[3,4,2,0,0],[3,4,3,0,2],[3,4,4,0,0],[3,4,5,0,1],
				 [3,5,1,0,1],[3,5,2,0,1],[3,5,3,0,1],[3,5,4,0,1],[3,5,5,0,1],
				                                                         
				 [4,1,1,0,1],[4,1,2,0,1],[4,1,3,0,1],[4,1,4,0,1],[4,1,5,0,1],
				 [4,2,1,0,1],[4,2,2,0,0],[4,2,3,0,0],[4,2,4,0,0],[4,2,5,0,1],
				 [4,3,1,0,1],[4,3,2,0,0],[4,3,3,0,2],[4,3,4,0,0],[4,3,5,0,1],
				 [4,4,1,0,1],[4,4,2,0,0],[4,4,3,0,0],[4,4,4,0,0],[4,4,5,0,1],
				 [4,5,1,0,1],[4,5,2,0,1],[4,5,3,0,1],[4,5,4,0,1],[4,5,5,0,1],
				                                                         
				 [5,1,1,0,1],[5,1,2,0,1],[5,1,3,0,1],[5,1,4,0,1],[5,1,5,0,1],
				 [5,2,1,0,1],[5,2,2,0,1],[5,2,3,0,1],[5,2,4,0,1],[5,2,5,0,1],
				 [5,3,1,0,1],[5,3,2,0,1],[5,3,3,0,1],[5,3,4,0,1],[5,3,5,0,1],
				 [5,4,1,0,1],[5,4,2,0,1],[5,4,3,0,1],[5,4,4,0,1],[5,4,5,0,1],
				 [5,5,1,0,1],[5,5,2,0,1],[5,5,3,0,1],[5,5,4,0,1],[5,5,5,0,1]];
	
	var colorType = [["red","#c82124"],["blue","#0066ff"],["black","#000000"]];
	
	var currentPlayer;
	
    var canvas;
    var ctx; 
	
	var selectCanvas;
	var selectCtx;
	
	//dove abbiamo salvato tutte le memorie 
	var listaMemo = new Array();
	
	//dove abbiamo salvato tutti i collegamenti
	var linkGrid = new Array();
	
	var p1Grid = new Array();
	var p2Grid = new Array();
	var p3Grid = new Array();

function drawGrid(context) {

	clearCanvas(context);

	var w = context.canvas.width;
	var h = context.canvas.height;
	
	var cellWidth = 100;
	var cellHeight = 100;
	
	context.beginPath();
	
    for (x=0;x<=w;x+=cellWidth) {
        for (y=0;y<=h;y+=cellHeight) {
            context.moveTo(x, 0);
            context.lineTo(x, h);
            context.stroke();
            context.moveTo(0, y);
            context.lineTo(w, y);
            context.stroke();
        }
    }
}

function clearCanvas(context){

	context.clearRect(0, 0, canvas.width, canvas.height);

}

function setCanvasSize(w, h, context){

	
	context.canvas.width  = w;
    context.canvas.height = h;	

}

function getValue(key, array){

	for(i = 0; i<array.length;i++){
	
		if(array[i][0]==key){
		
			return array[i][1];
		
		}
	
	}

}
	
function drawView(player){
	
	var memW;
	var memH;
	
	drawGrid(ctx);
	
	for(i=0;i<listaMemo.length;i++){
	

		if(memosGrid[listaMemo[i][0]][3]>0 && listaMemo[i][1]==1){
		
			if(player==1){
				memW = memosGrid[listaMemo[i][0]][0];
				memH = memosGrid[listaMemo[i][0]][1];
				
				p1Grid.push([memW,memH,listaMemo[i][0]]);
			}
			
			if(player==2){
				memW = memosGrid[listaMemo[i][0]][1];
				memH = memosGrid[listaMemo[i][0]][2];
				
				p2Grid.push([memW,memH,listaMemo[i][0]]);
			}
			
			if(player==3){
				memW = memosGrid[listaMemo[i][0]][0];
				memH = memosGrid[listaMemo[i][0]][2];
				
				p3Grid.push([memW,memH,listaMemo[i][0]]);
			}
			//			X	Y		box number			color
			drawCircle(memW, memH, listaMemo[i][0], colorType[memosGrid[listaMemo[i][0]][3]-1][1],ctx);
			//console.log("memo for player "+ player +" drawn at (" + memH + ", " + memW + ")");
		}
	}

}

function drawCircle(memW, memH, text, hexColor, context){

	context.beginPath();
	context.moveTo(memW*100,((memH-1)*100)+50);
	context.arc((memW*100)-50,((memH-1)*100)+50, 50, 0, 2 * Math.PI);
	context.fillStyle = hexColor; 
	context.fill();
	context.stroke();
	context.font = "30px Arial";
	context.fillStyle = "white";
	context.textAlign = "center";
	context.fillText(text,(memW*100)-50 ,((memH-1)*100)+50);

}

function populateGrid(amount,type){
		
		var i = 0;
		
		while(i<amount) {
		
		var rand = Math.floor(Math.random() * 124);

			if(memosGrid[rand][3]==0 && memosGrid[rand][4] == type){
			
				memosGrid[rand][3]=type;
				
				console.log(colorType[type-1][0] +" memo in position " + rand + " activated");
				
				if(type==1){
					
					listaMemo.push([rand,1]);
					
				} else {
					
					listaMemo.push([rand,0]);
				
				}
				console.log(listaMemo);
				i++;
				
			}
		}
}

function setCenter(){
		
			
	memosGrid[62][3]=3;			
	console.log("center memo activated");

}
		
function reset(){

 for(i=0;i<125;i++){
 
	memosGrid[i][3] = 0;
 
  }
  listaMemo = [];
  p1Grid = [];
  p2Grid = [];
  p3Grid = [];

}

function genera(){

reset();
setCenter();
populateGrid(3,2);
populateGrid(6,1);
creaLink();

}

function creaLink(){



}

function drawLink(mem1,mem2, player){

	var mem1X;
	var mem1Y;
	
	var mem2X;
	var mem2Y;
	
	if(player==1){
		mem1X = memosGrid[mem1][0];
		mem1Y = memosGrid[mem1][1];
		
		mem2X = memosGrid[mem2][0];
		mem2Y = memosGrid[mem2][1];
	}   
		
	if(player==2){
		mem1X = memosGrid[mem1][1];
		mem1Y = memosGrid[mem1][2];
		
		mem2X = memosGrid[mem2][1];
		mem2Y = memosGrid[mem2][2];
	}   
		
	if(player==3){
		mem1X = memosGrid[mem1][0];
		mem1Y = memosGrid[mem1][2];
		
		mem2X = memosGrid[mem2][0];
		mem2Y = memosGrid[mem2][2];
	}

	ctx.beginPath();
	ctx.moveTo(mem1X+50, mem1Y+50);
	ctx.lineTo(mem2X+50, mem2X+50);
	ctx.stroke();

}
				
window.addEventListener('load', function () {

	canvas = document.getElementById("grid");
	ctx = canvas.getContext('2d');
	
	selectCanvas = document.getElementById("selectGrid");
	selectCtx = selectCanvas.getContext('2d');
	
	setCanvasSize(500,500, ctx);
	setCanvasSize(500,500, selectCtx);
	
	selectCanvas.addEventListener('click', function(e) {
    selectMemo(selectCtx,selectCanvas, e, getCurrentPlayer())
});

});

function selectMemo(context,canvas, event, player) {

	
	clearCanvas(context);
    
	const rect = canvas.getBoundingClientRect()
    const x = event.clientX - rect.left
    const y = event.clientY - rect.top
	
	var boxX = Math.round((x+50)/100);
	var boxY = Math.round((y+50)/100);
	
	if(!isNaN(getPosition(boxX,boxY,player))){
	
	drawCircle(boxX,boxY,"S","#00ff00", selectCtx);
	
	console.log("x: " + x + " y: " + y + ". The selected box is: ( "+ boxX + ", "+ boxY +"), which is number " + getPosition(boxX,boxY,player));
	
	}
}

function getPosition(x,y,player){

	if(player==1){

		return findInPlayerGrid(p1Grid,x,y);

	}

	if(player==2){

		return findInPlayerGrid(p2Grid,x,y);

	}

	if(player==3){

		return findInPlayerGrid(p3Grid,x,y);

	}

}

function findInPlayerGrid(playerGrid,x,y){

	for(i=0;i<playerGrid.length;i++){
		
		
			if(playerGrid[i][0]==x && playerGrid[i][1]==y){
			
				return playerGrid[i][2];
			
			}
		
}

}

function getCurrentPlayer(){

	return currentPlayer;

}

function setCurrentPlayer(player){

	currentPlayer = player;
	
	document.getElementById("player1").style.background='none';
	document.getElementById("player2").style.background='none';
	document.getElementById("player3").style.background='none';
	
	document.getElementById("player"+player).style.background='#00ff00';
	

}



</script>
<html>
<body>
<!--<canvas id="grid"></canvas>-->

 <canvas id="grid" 			style="position: absolute; left: 0px; top: 0px; z-index: 0;"></canvas>
 <canvas id="selectGrid"	style="position: absolute; left: 0px; top: 0px; z-index: 1;"></canvas>

<div id="buttonBar" style="position: absolute; left: 0px; top: 550px;">
<button onclick='genera();'>Genera Griglia</button>
<button id="player1" onclick='setCurrentPlayer(1);drawView(1);'>Giocatore 1</button>
<button id="player2" onclick='setCurrentPlayer(2);drawView(2);'>Giocatore 2</button>
<button id="player3" onclick='setCurrentPlayer(3);drawView(3);'>Giocatore 3</button>
</div>
</body>
</html>